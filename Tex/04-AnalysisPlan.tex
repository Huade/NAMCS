\section{Analysis Plan}
Ideally, we would observe physician in three possible conditions: one in which she has fully adopted the EHR system, one in which she has partially adopted the EHR system, and one in which she has not. We can express our evaluation problem as follows: Let $W_i = 1$ for physician $i$ who has fully adopted the EHR system, let $W_i = 2$ for physician $i$ who has partially adopted the EHR system, and let $W_i = 0$ for physician $i$ who has not yet adopted the ENR system. Let $Y_i(1)$ refer to the time efficiency for physician $i$ who has fully adopted the EHR system, let $Y_i(2)$ refer to the time efficiency for physician $i$ who has partially adopted the EHR system, and let $Y_i(0)$ refer to the patient-interaction time for physician $i$ who has not not adopted the EHR system. Although all outcomes are possible in theory, we cannot observe all possible outcome $Y_i(0)$, $Y_i(1)$, and $Y_i(2)$ for physician $i$ while holding all other conditions constant. We only observe $Y_i(0)$ if $W_i = 0$, $Y_i(1)$ if $W_i = 1$, and $Y_i(2)$ if $W_i = 2$ with our data \citep{imbens2008recent}.

\subsection{Assumption of causal inference}
There are two assumptions associate with estimating treatment effect. The first assumption is the stable unit treatment value assumption (SUTVA). 

The second assumption is no unmeasured confounders. An estimate of the EHR's effect on physicians' behavior relies on an assumption of no unmeasured confounders of treatment assignment, that is, $W_i \prep (Y_i(0),Y_i(1),Y_i(2))$ \citep{imbens2008recent}. In other words, the assignment of study participants to treatment conditions (i.e. fully adopted EHR, partially adopted EHR, and no adoption) is independent of the outcome of these three groups. In experimental settings, treatment groups (in this case, physicians who partially or fully adopted the EHR system) and control group were random assigned, which ensure that both observed and unobserved factors of treatment and control group have similar distribution. If assignment to adopt the EHR system is based on randomization, this assumption is easy to statisfy and the causal inference would be straightforward. However, this assumption often violates in non-experimental setting. This is a strong assumption with the evaluation of EHR effect since a national level experiment on the effectiveness of the EHR adoption is expensive and infeasible. Violation of unconfoundedness could bias results because of omitted variable bias.

To estimate the effect of the EHR adoption on physician behavior, we can obtain the following model:

\begin{equation*}
Y_{i} = \beta_0 + \beta_1 W_i + \Sigma^k_{i=2} \beta_k X_{ik} + \epsilon_{i}
\end{equation*}

In this model, $Y_{i}$ is the outcome of interest for physician $i$, including percentage rate of patient-specific education resource prescribed, time spent with physician, and percentage rate of returned patients. $W_i$ is the EHR adoption status for physician $i$, including fully adopted EHR, partially adopted EHR, and no EHR adoption. $X_{ik}$ are $k$ observable characteristics for physician $i$, including MSA status, physician speciality, Solo status, etc. We will describe more details in descriptive statistics section. Coefficient $\beta_1$ estimate the treatment effect of the EHR adoption on three outcome variables if the model is correct and satisfies the assumption of unconfoundedness. This condition is unlikely with NAMCS data.


%WHY PS
\subsection{Propensity score estimation}
As described above, estimating causal effects with observational data is challenging since it involves estimating the unobserved potential outcomes. For example, physicians in treatment group A, which they fully adopted the EHR systems, may systematically different than physicians in the control group. This difference could in both observed and unobserved ways. With large number of covariates that has unknown functional relationship with treatment and outcome, it is difficult to specify regression adjustment model. Without appropriate instrumental variable or regression discontinuity cutoff available, the propensity score matching method is one of few available techniques that can be used to access the treatment effect of the EHR system on physician behavior.

With propensity score weighting, treatment assignment and the observed covariates are conditionally independent given the propensity score \citep{guo2014propensity}:

\begin{equation*}
\textbf{X_i} \prep W_i | e(X_i)
\end{equation*}

Conditional on the propensity score, each physician has the same probability of assignment to treatment, as in a randomized experiment setting.

With extensive information available in NAMCS data, I added various pre-treatment covariates with physician weight when estimating propensity score.   

% WHY GBM
Hirano et al. claimed that the resulting estimate is asymptotically effcient if the propensity score is estimated non-parametrically using a series estimator \citep{hirano2003efficient}. I used Generalized Boosted Machine (GBM) model to estimate propensity score of each physicians. GBM is a general, automated, data-adaptive algorithm that fits several models by way of a regression tree, and then merges the predictions produced by each model. Comparing with traditional models, GBM model offer numerous advantage to solve the variable specification problem \citep{guo2009propensity}. 

\subsection{Propensity score weighting}
The key feature of propensity score weighting model is the treatment of estimated propensity scores as sampling weights to perform a weighted outcome analysis. The control of selection biases is achieved through weighting. Counterfactuals are estimated through a regression model \citep{guo2009propensity}.

When dimision of pre-treatment variables $\textbf{X}$ is large, it is difficult to ensure both the regression model is correct and a consistent estimator will be obtained \citep{rubin1997estimating}. Also, the estimated modeling leads to extrapolation if the distribution of some confounders do not overlap with each other, since the effect is primarily determined by treated subjects in one region of $\textbf{X}$ space and by control subjects in another. In contrast, the regression model with propensity score weighting largely circumvents this since pretreatment variables $\textbf{X}$ and treatment group variable $W$ should be approximately independent after propensity score estimation. By adding covariates into the regression adjustment, we will obtain ``double robustness'' which further improve the precision of estimators \citep{lunceford2004stratification}. I used an estimate of the propensity score as weights, and uses these weights in a weighted regression of the outcome on treatment and covariates.
